+++
title = 'Табло теннисного матча'
weight = 4
+++

# Проект "Табло теннисного матча"

Веб-приложение, реализующее табло счёта теннисного матча.

Комментарии по проекту - [https://www.youtube.com/watch?v=zAOiNa24jpg](https://www.youtube.com/watch?v=zAOiNa24jpg).

## Что нужно знать

- [Go](../technologies/go.md) - std lib, http, пакеты
- [Паттерн MVC(S)](../technologies/go.md#mvc) 
- [Go modules](../technologies/build-systems.md)
- [Backend](../technologies/backend.md)
  - Go HTTP standard library
  - HTTP - GET и POST запросы, коды ответа
  - REST API, JSON
- [Базы данных](../technologies/databases.md) - postgresql, драйвер для бд
- [Опционально] [Frontend](../technologies/frontend.md) - HTML/CSS, блочная вёрстка
- [Тесты](../technologies/tests.md) - юнит тестирование, testify
- [Деплой](../technologies/dev-ops.md#деплой) - облачный хостинг, командная строка Linux

## Мотивация проекта

- Создать клиент-серверное приложение с веб-интерфейсом
- Получить практический опыт работы с postgresql
- Сверстать простой веб-интерфейс без сторонних библиотек
- Познакомиться с архитектурным паттерном MVC(S)

Комментарии:

- Проект не подразумевает фреймворки, ради практики с паттерном MVC, использование фрейморков начнется с проекта #5
- Не используем Bootstrap, для практики верстки вручную, Bootstrap можно будет использовать в проекте #5
- Проект не многопользовательский, поэтому не используем сессии 

## Функционал приложения

Работа с матчами:

- Создание нового матча
- Просмотр законченных матчей, поиск матчей по именам игроков
- Подсчёт очков в текущем матче

## Подсчёт очков в теннисном матче

В теннисе особая система подсчёта очков - https://www.gotennis.ru/read/world_of_tennis/pravila.html

Для упрощения, допустим что каждый матч играется по следующим правилам:
- Матч играется до двух сетов (best of 3)
- При счёте 6/6 в сете, играется тай-брейк до 7 очков

## Интерфейс приложения

### Главная страница

- Ссылки, ведущие на страницы нового матча и списка завершенных матчей

### Страница нового матча

Адрес - `/new-match`.

Интерфейс:
- HTML форма с полями “Имя игрока 1”, “Имя игрока 2” и кнопкой “начать”. Для упрощения допустим, что имена игроков уникальны. Игрок не может играть сам с собой.
- Нажатие кнопки “начать” приводить к POST запросу по адресу `/new-match`

Обработчик POST запроса:
- Проверяет существование игроков в таблице `Players`. Если игрока с таким именем не существует, создаём
- Создаём экземпляр структуры, содержащего айди игроков и текущий счёт, и кладём в коллекцию текущих матчей (существующую только в памяти приложения, либо в key-value storage). Ключом коллекции является UUID, значением - счёт в матче
- Редирект на страницу `/match-score?uuid=$match_id`

### Страница счёта матча - `/match-score`

Адрес - `/match-score?uuid=$match_id`. GET параметр `uuid` содержит UUID матча.

Интерфейс:

- Таблица с именами игроков, текущим счётом
- Формы и кнопки для действий - "игрок 1 выиграл текущее очко", "игрок 2 выиграл текущее очко"
- Нажатие кнопок приводит к POST запросу по адресу `/match-score?uuid=$match_id`, в полях отправленной формы содержится айди выигравшего очко игрока

Обработчик POST запроса:

- Извлекает из коллекции экземпляр структуры Match
- В соответствии с тем, какой игрок выиграл очко, обновляет счёт матча
- Если матч не закончился - рендерится таблица счёта матча с кнопками, описанными выше
- Если матч закончился:
    - Удаляем матч из коллекции текущих матчей
    - Записываем законченный матч в SQL базу данных
    - Рендерим финальный счёт

### Страница сыгранных матчей - `/matches`

Адрес - `/matches?page=$page_number&filter_by_player_name=$player_name`. GET параметры:
- `page` - номер страницы. Если параметр не задан, подразумевается первая страница
- `filter_by_player_name` - имя игрока, матчи которого ищем. Если параметр не задан, отображаются все матчи

Постранично отображает список сыгранных матчей. Позволяет искать матчи игрока по его имени. Для постраничного отображения потребуется реализация пагинации.

Интерфейс:
- Форма с фильтром по имени игрока. Поле ввода для имени и кнопка "искать". По нажатию формируется GET запрос вида `/matches?filter_by_player_name=${NAME}`
- Список найденных матчей
- Переключатель страниц, если матчей найдено больше, чем влезает на одну страницу

## Фронтенд

Я считаю, что уметь делать простой фронтенд с нуля - универсально полезный навык для всех разработчиков. Однако, в условиях дефицита времени это может быть нерационально.

Поэтому, для проекта существует готовая верстка, которую можно взять за основу. Если хотите расширить функционал проекта или сделать верстку с нуля - приветствую желание самостоятельно это сделать.

Репозиторий с версткой - [https://github.com/zhukovsd/tennis-scoreboard-html-layouts](https://github.com/zhukovsd/tennis-scoreboard-html-layouts).

Что внутри - макеты четырёх страниц, адаптивная верстка (десктопы, телефоны). Минимальный Javascript для показа меню навигации на телефонах.

Задеплоенные на GitHub Pages страницы для демонстрации:
- [Главная страница](https://zhukovsd.github.io/tennis-scoreboard-html-layouts/)
- [Новый матч](https://zhukovsd.github.io/tennis-scoreboard-html-layouts/new-match.html)
- [Счёт текущего матч](https://zhukovsd.github.io/tennis-scoreboard-html-layouts/match-score.html)
- [Завершенные матчи](https://zhukovsd.github.io/tennis-scoreboard-html-layouts/matches.html)

Как пользоваться:
- Перенести в проект нужные для веб-страниц ресурсы - CSS, картинки
- На основе HTML верстки создать шаблонизированные страницы с добавлением тегов JSP

## База данных

В качестве базы данных предлагаю использовать Postgresql.

#### Таблица `Players` - игроки

| Имя колонки | Тип     | Комментарий                   |
|-------------|---------|-------------------------------|
| ID          | Int     | Первичный ключ, автоинкремент |
| Name        | Varchar | Имя игрока                    |

Индексы:
- Уникальный индекс колонки `Name` для эффективности поиска игроков по имени и запрета повторяющихся имён

### Таблица `Matches` - завершенные матчи

Для упрощения, в БД сохраняются только доигранные матчи в момент их завершения.

| Имя колонки | Тип | Комментарий                                     |
|-------------|-----|-------------------------------------------------|
| ID          | Int | Первичный ключ, автоинкремент                   |
| Player1     | Int | Айди первого игрока, внешний ключ на Players.ID |
| Player2     | Int | Айди второго игрока, внешний ключ на Players.ID |
| Winner      | Int | Айди победителя, внешний ключ на Players.ID     |

## MVCS

MVCS - архитектурный паттерн, особенно хорошо подходящий под реализацию подобных приложений. Я подразумеваю, что студент самостоятельно изучил что такое MVCS, и ниже приведу только пример того, как он может быть использован в данном проекте.

### Учёт счёта матча

Пример (именование классов и сервисов на мой вкус):

`MatchScoreController`:
- Обрабатывает POST запросы к `/match-score`
- Через `OngoingMatchesService` получает экземпляр структуры `Match` для текущего матча, который является моделью/частью модели `MatchScoreModel`
- Через `MatchScoreCalculationService` обновляет счёт в матче
- Если матч закончился - через `FinishedMatchesPersistenceService` сохраняет законченный матч в базу данных
- С помощью Go шаблона отображает `MatchScoreModel` в виде отрендеренного HTML

Каждый из упомянутых сервисов делает конкретную работу:

- `OngoingMatchesService` хранит текущие матчи и позволяет их записывать/читать
- `MatchScoreCalculationService` реализует логику подсчёта счёта матча по очкам/геймам/сетам
- `FinishedMatchesPersistenceService` инкапсулирует чтение и запись законченных матчей в БД

## Тесты

Покроем юнит тестами подсчёт очков в матче. Примеры кейсов:

- Если игрок 1 выигрывает очко при счёте 40-40, гейм не заканчивается
- Если игрок 1 выигрывает очко при счёте 40-0, то он выигрывает и гейм
- При счёте 6-6 начинается тайбрейк вместо обычного гейма

Предлагаю студентам самостоятельно придумать тест кейсы для покрытия всех вариантов изменения счёта в матче, особенно правила "больше-меньше" и тайбрейк. Набор тестов должен быть реализован с помощью testify или go-mock. 

## Деплой

Будем вручную деплоить приложение на удалённый сервере.
Шаги:

- В хостинг-провайдере по выбору арендовать облачный сервер на Linux
- Подключиться к серверу через SSH, установить Go и поднять postgresql
- Используя git склонировать проект
- Написать команду для запуска приложения в background режиме, чтобы после отключения от консоли сервера оно продолжало работать

Ожидаемый результат - приложение доступно по адресу `http://$server_ip:8080/$app_root_path`.

## План работы над приложением

- Прописать go-модели для таблиц БД
- Страница создания нового матча
- Сервисы для хранения текущих матчей и подсчета очков в матче, юнит тесты для подсчёта очков
- Страница счёта матча
- Сервис для сохранения законченного матча в БД
- Сервис поиска законченных матчей по имени игрока
- Страница отображения законченных матчей, поиска матчей по имени игрока
- Деплой на удалённый сервер

## Ресурсы для работы над ошибками

- [Реализации проекта](../finished-projects/tennis-scoreboard.md) другими студентами и мои ревью этих реализаций
- Присылайте законченные проекты в [чат](https://t.me/zhukovsd_it_chat), добавляю их в [список](../finished-projects/tennis-scoreboard.md), сообщество делает ревью проектов
